# æ¿€è¿›ä¼˜åŒ–æ–¹æ¡ˆ - è®¢å•ä¸­å¿ƒåŒ–é‡æ„

## ğŸ“… è§„åˆ’æ—¥æœŸï¼š2025-10-22

---

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**ä¸€ä¸ªè®¢å•ï¼Œä¸€ä¸ªé¡µé¢ï¼Œå®Œæˆæ‰€æœ‰æ“ä½œï¼**

å°†åˆ†æ•£åœ¨ä¸‰ä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œæ•´åˆåˆ°**ä¸€ä¸ªç»Ÿä¸€çš„è®¢å•ä¸­å¿ƒ**ï¼Œç”¨æˆ·ä¸å†éœ€è¦åœ¨é¡µé¢é—´åˆ‡æ¢ã€‚

---

## ğŸ’¡ è®¾è®¡æ€è·¯

### å½“å‰é—®é¢˜ï¼ˆæ ¹æœ¬åŸå› ï¼‰
```
é—®é¢˜ï¼šç”¨æˆ·è¦å¤„ç†"ä¸€ä¸ªè®¢å•"ï¼Œå´è¦åœ¨"ä¸‰ä¸ªé¡µé¢"ä¸­æ“ä½œ

è®¢å•ç®¡ç†é¡µé¢ï¼šæŸ¥çœ‹è®¢å•åˆ—è¡¨ã€åˆ›å»ºè®¢å•ã€ç¼–è¾‘åŸºæœ¬ä¿¡æ¯
    â†“ åˆ‡æ¢é¡µé¢
è¿›åº¦ç®¡ç†é¡µé¢ï¼šæœç´¢è®¢å• â†’ æ›´æ–°è¿›åº¦ â†’ ä¸Šä¼ ç…§ç‰‡
    â†“ åˆ‡æ¢é¡µé¢  
ç…§ç‰‡ç®¡ç†é¡µé¢ï¼šæœç´¢è®¢å• â†’ æŸ¥çœ‹ç…§ç‰‡ â†’ åˆ é™¤ç…§ç‰‡

è¿™æ˜¯å…¸å‹çš„"åŠŸèƒ½å¯¼å‘"è®¾è®¡ï¼Œä¸æ˜¯"ä¸šåŠ¡å¯¼å‘"è®¾è®¡
```

### æ–°æ–¹æ¡ˆï¼ˆä¸šåŠ¡å¯¼å‘ï¼‰
```
è®¢å•ä¸­å¿ƒé¡µé¢ï¼š
â”œâ”€â”€ å·¦ä¾§ï¼šè®¢å•åˆ—è¡¨ï¼ˆç­›é€‰ã€æœç´¢ï¼‰
â””â”€â”€ å³ä¾§ï¼šè®¢å•è¯¦æƒ…å¡ç‰‡
    â”œâ”€â”€ Tab1: ğŸ“‹ åŸºæœ¬ä¿¡æ¯ï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ï¼‰
    â”œâ”€â”€ Tab2: ğŸ”„ åˆ¶ä½œè¿›åº¦ï¼ˆæŸ¥çœ‹ã€æ›´æ–°ã€å®Œæˆé˜¶æ®µï¼‰
    â””â”€â”€ Tab3: ğŸ“· åˆ¶ä½œç…§ç‰‡ï¼ˆæŸ¥çœ‹ã€ä¸Šä¼ ã€åˆ é™¤ï¼‰

ä¸€ä¸ªè®¢å•çš„æ‰€æœ‰æ“ä½œï¼Œåœ¨ä¸€ä¸ªé¡µé¢å®Œæˆï¼
```

---

## ğŸš€ æ–°ç‰ˆè®¢å•ä¸­å¿ƒåŸå‹

### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ è®¢å•ä¸­å¿ƒ                                   [â• æ–°å»ºè®¢å•]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¢å•åˆ—è¡¨ (30%)   â”‚ è®¢å•è¯¦æƒ… (70%)                                â”‚
â”‚                  â”‚                                               â”‚
â”‚ [ğŸ” æœç´¢æ¡†]      â”‚ â”Œâ”€ è®¢å• LD20251016114314 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ [çŠ¶æ€ç­›é€‰ â–¼]     â”‚ â”‚ å®¢æˆ·ï¼šé«˜é•¿æ˜¥ | ğŸ“ 138****1234           â”‚  â”‚
â”‚                  â”‚ â”‚ é’»çŸ³ç±»å‹ï¼šçºªå¿µé’»çŸ³ | è§„æ ¼ï¼š0.5å…‹æ‹‰       â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ çŠ¶æ€ï¼šåˆ¶ä½œä¸­ | è¿›åº¦ï¼š25%                â”‚  â”‚
â”‚ â”‚ ğŸ“„ LD20251... â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚ é«˜é•¿æ˜¥        â”‚â”‚                                               â”‚
â”‚ â”‚ åˆ¶ä½œä¸­ | 25%  â”‚â”‚ [ğŸ“‹ åŸºæœ¬ä¿¡æ¯] [ğŸ”„ åˆ¶ä½œè¿›åº¦] [ğŸ“· åˆ¶ä½œç…§ç‰‡]    â”‚
â”‚ â”‚ âœ… å·²é€‰ä¸­     â”‚â”‚                                               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  â”‚ â”‚ åˆ¶ä½œè¿›åº¦                                  â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚                                           â”‚ â”‚
â”‚ â”‚ ğŸ“„ LD20251... â”‚â”‚ â”‚ âœ… åŸæ–™æ£€æµ‹ (å·²å®Œæˆ) 2025-10-16           â”‚ â”‚
â”‚ â”‚ ç‹å°æ˜        â”‚â”‚ â”‚    å¤‡æ³¨ï¼šåŸæ–™è´¨é‡ä¼˜è‰¯                     â”‚ â”‚
â”‚ â”‚ å¾…å¤„ç† | 0%   â”‚â”‚ â”‚    ğŸ“· 3å¼ ç…§ç‰‡                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                                           â”‚ â”‚
â”‚                  â”‚ â”‚ ğŸ”„ é«˜æ¸©é«˜å‹ (è¿›è¡Œä¸­) 2025-10-18           â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚    [â–¶ å®Œæˆæ­¤é˜¶æ®µ] [ğŸ“ æ·»åŠ å¤‡æ³¨]          â”‚ â”‚
â”‚ â”‚ ğŸ“„ LD20251... â”‚â”‚ â”‚    [ğŸ“· ä¸Šä¼ ç…§ç‰‡]                          â”‚ â”‚
â”‚ â”‚ æå          â”‚â”‚ â”‚                                           â”‚ â”‚
â”‚ â”‚ å·²å®Œæˆ | 100% â”‚â”‚ â”‚ â¸ï¸ åˆ‡å‰²æ‰“ç£¨ (å¾…å¤„ç†)                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚    [â–¶ å¼€å§‹æ­¤é˜¶æ®µ]                         â”‚ â”‚
â”‚                  â”‚ â”‚                                           â”‚ â”‚
â”‚ [1] [2] [3] ... â”‚â”‚ â”‚ â¸ï¸ è´¨é‡æ£€éªŒ (å¾…å¤„ç†)                      â”‚ â”‚
â”‚                  â”‚ â”‚ â¸ï¸ æˆå“åŒ…è£… (å¾…å¤„ç†)                      â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–°çš„æ–‡ä»¶ç»“æ„

```
streamlit_app/
â”œâ”€â”€ pages_backup/          # æ—§é¡µé¢ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰
â”‚   â”œâ”€â”€ admin_orders.py
â”‚   â”œâ”€â”€ admin_progress.py
â”‚   â””â”€â”€ admin_photos.py
â”‚
â”œâ”€â”€ pages/                 # æ–°é¡µé¢ï¼ˆé‡å†™ï¼‰
â”‚   â”œâ”€â”€ admin_orders_center.py  âœ¨ æ ¸å¿ƒé¡µé¢ï¼
â”‚   â”œâ”€â”€ admin_dashboard.py      ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â”œâ”€â”€ admin_users.py          ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â””â”€â”€ admin_role_permissions.py ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚
â”œâ”€â”€ components/           # å¯å¤ç”¨UIç»„ä»¶ï¼ˆæ–°å»ºï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ order_list.py          # è®¢å•åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ order_info_card.py     # è®¢å•ä¿¡æ¯å¡ç‰‡
â”‚   â”œâ”€â”€ progress_timeline.py   # è¿›åº¦æ—¶é—´è½´
â”‚   â””â”€â”€ photo_gallery.py       # ç…§ç‰‡ç”»å»Š
â”‚
â””â”€â”€ services/             # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆå……åˆ†åˆ©ç”¨ï¼‰
    â”œâ”€â”€ order_service.py
    â”œâ”€â”€ progress_service.py
    â””â”€â”€ photo_service.py
```

---

## ğŸ¨ æ ¸å¿ƒé¡µé¢è®¾è®¡

### `admin_orders_center.py` - è®¢å•ä¸­å¿ƒï¼ˆæ–°å»ºï¼‰

```python
"""
è®¢å•ä¸­å¿ƒ - ç»Ÿä¸€ç®¡ç†è®¢å•ã€è¿›åº¦ã€ç…§ç‰‡

æ¶æ„ï¼š
- å·¦ä¾§ï¼šè®¢å•åˆ—è¡¨ï¼ˆcomponents.order_listï¼‰
- å³ä¾§ï¼šè®¢å•è¯¦æƒ…ï¼ˆä¸‰ä¸ªTabï¼‰
  - Tab1: åŸºæœ¬ä¿¡æ¯ï¼ˆcomponents.order_info_cardï¼‰
  - Tab2: åˆ¶ä½œè¿›åº¦ï¼ˆcomponents.progress_timelineï¼‰  
  - Tab3: åˆ¶ä½œç…§ç‰‡ï¼ˆcomponents.photo_galleryï¼‰
"""

import streamlit as st
from services.order_service import OrderService
from services.progress_service import ProgressService
from services.photo_service import PhotoService
from components import order_list, order_info_card, progress_timeline, photo_gallery
from utils.cloudbase_client import api_client
from utils.auth import auth_manager

# åˆå§‹åŒ–æœåŠ¡
order_service = OrderService(api_client)
progress_service = ProgressService(api_client)
photo_service = PhotoService(api_client)


def show_page():
    """è®¢å•ä¸­å¿ƒä¸»é¡µé¢"""
    if not auth_manager.require_permission("orders.read"):
        return
    
    st.title("ğŸ“ è®¢å•ä¸­å¿ƒ")
    
    # é¡¶éƒ¨å·¥å…·æ 
    col1, col2 = st.columns([4, 1])
    with col2:
        if st.button("â• æ–°å»ºè®¢å•", width="stretch"):
            st.session_state.show_create_order_modal = True
    
    # åŒåˆ—å¸ƒå±€
    left_col, right_col = st.columns([3, 7])
    
    # å·¦ä¾§ï¼šè®¢å•åˆ—è¡¨
    with left_col:
        show_order_list_panel()
    
    # å³ä¾§ï¼šè®¢å•è¯¦æƒ…
    with right_col:
        show_order_detail_panel()
    
    # æ¨¡æ€æ¡†ï¼šæ–°å»ºè®¢å•
    if st.session_state.get('show_create_order_modal', False):
        show_create_order_modal()


def show_order_list_panel():
    """æ˜¾ç¤ºè®¢å•åˆ—è¡¨é¢æ¿"""
    st.markdown("### ğŸ“‹ è®¢å•åˆ—è¡¨")
    
    # æœç´¢å’Œç­›é€‰
    search = st.text_input("ğŸ”", placeholder="æœç´¢è®¢å•å·/å®¢æˆ·å§“å", label_visibility="collapsed")
    status_filter = st.selectbox(
        "çŠ¶æ€ç­›é€‰",
        ["å…¨éƒ¨", "å¾…å¤„ç†", "åˆ¶ä½œä¸­", "å·²å®Œæˆ"],
        label_visibility="collapsed"
    )
    
    # ä½¿ç”¨è®¢å•åˆ—è¡¨ç»„ä»¶
    selected_order = order_list.show(
        order_service=order_service,
        search=search,
        status_filter=status_filter,
        page_size=10
    )
    
    # ä¿å­˜é€‰ä¸­çš„è®¢å•
    if selected_order:
        st.session_state.selected_order_id = selected_order['_id']


def show_order_detail_panel():
    """æ˜¾ç¤ºè®¢å•è¯¦æƒ…é¢æ¿"""
    order_id = st.session_state.get('selected_order_id')
    
    if not order_id:
        st.info("ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªè®¢å•")
        return
    
    # è·å–è®¢å•å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å«è¿›åº¦å’Œç…§ç‰‡ï¼‰
    with st.spinner("åŠ è½½è®¢å•è¯¦æƒ…..."):
        result = order_service.get_order(order_id)
    
    if not result.get('success'):
        st.error(f"åŠ è½½å¤±è´¥ï¼š{result.get('message')}")
        return
    
    data = result['data']
    order = data['order']
    progress = data['progress']
    photos = data['photos']
    allowed_actions = data['allowed_actions']
    
    # è®¢å•æ¦‚è§ˆå¡ç‰‡
    order_info_card.show(order)
    
    # ä¸‰ä¸ªTab
    tab1, tab2, tab3 = st.tabs(["ğŸ“‹ åŸºæœ¬ä¿¡æ¯", "ğŸ”„ åˆ¶ä½œè¿›åº¦", "ğŸ“· åˆ¶ä½œç…§ç‰‡"])
    
    with tab1:
        show_basic_info_tab(order, allowed_actions)
    
    with tab2:
        show_progress_tab(order, progress, allowed_actions)
    
    with tab3:
        show_photos_tab(order, photos, allowed_actions)


def show_basic_info_tab(order, allowed_actions):
    """åŸºæœ¬ä¿¡æ¯Tab"""
    st.markdown("### è®¢å•åŸºæœ¬ä¿¡æ¯")
    
    # æ˜¾ç¤ºä¿¡æ¯
    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"**è®¢å•å·ï¼š** {order.get('order_number')}")
        st.markdown(f"**å®¢æˆ·å§“åï¼š** {order.get('customer_name')}")
        st.markdown(f"**è”ç³»ç”µè¯ï¼š** {order.get('customer_phone')}")
    
    with col2:
        st.markdown(f"**é’»çŸ³ç±»å‹ï¼š** {order.get('diamond_type')}")
        st.markdown(f"**é’»çŸ³è§„æ ¼ï¼š** {order.get('diamond_size')}")
        st.markdown(f"**è®¢å•çŠ¶æ€ï¼š** {order.get('order_status')}")
    
    st.markdown(f"**å¤‡æ³¨ï¼š** {order.get('notes', 'æ— ')}")
    
    # æ“ä½œæŒ‰é’®
    if 'update' in allowed_actions:
        if st.button("âœï¸ ç¼–è¾‘è®¢å•ä¿¡æ¯", width="stretch"):
            st.session_state.editing_order = order
            st.rerun()
    
    # ç¼–è¾‘è¡¨å•ï¼ˆå¦‚æœå¤„äºç¼–è¾‘çŠ¶æ€ï¼‰
    if st.session_state.get('editing_order'):
        show_edit_order_form(order)


def show_progress_tab(order, progress, allowed_actions):
    """åˆ¶ä½œè¿›åº¦Tab"""
    st.markdown("### åˆ¶ä½œè¿›åº¦")
    
    # è¿›åº¦æ¦‚è§ˆ
    current_stage = progress_service.get_current_stage(progress)
    next_stage = progress_service.get_next_stage(progress)
    
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric("æ€»è¿›åº¦", f"{order.get('progress_percentage', 0)}%")
    with col2:
        st.metric("å½“å‰é˜¶æ®µ", current_stage.get('stage_name', 'æœªå¼€å§‹') if current_stage else 'æœªå¼€å§‹')
    with col3:
        st.metric("å·²å®Œæˆé˜¶æ®µ", f"{len(progress_service.get_completed_stages(progress))}/{len(progress)}")
    
    st.markdown("---")
    
    # ä½¿ç”¨è¿›åº¦æ—¶é—´è½´ç»„ä»¶
    progress_timeline.show(
        progress_service=progress_service,
        order_id=order['_id'],
        progress_data=progress,
        allowed_actions=allowed_actions,
        on_update=lambda: st.rerun()
    )


def show_photos_tab(order, photos, allowed_actions):
    """åˆ¶ä½œç…§ç‰‡Tab"""
    st.markdown("### åˆ¶ä½œç…§ç‰‡")
    
    # ç…§ç‰‡ç»Ÿè®¡
    photo_count = photo_service.get_photo_count(photos)
    grouped_photos = photo_service.group_photos_by_stage(photos)
    
    col1, col2 = st.columns([3, 1])
    with col1:
        st.metric("ç…§ç‰‡æ€»æ•°", f"{photo_count} å¼ ")
    with col2:
        if 'upload_photo' in allowed_actions:
            if st.button("ğŸ“· ä¸Šä¼ ç…§ç‰‡", width="stretch"):
                st.session_state.show_upload_photo_modal = True
    
    st.markdown("---")
    
    # ä½¿ç”¨ç…§ç‰‡ç”»å»Šç»„ä»¶
    photo_gallery.show(
        photo_service=photo_service,
        order_id=order['_id'],
        photos_data=photos,
        grouped_photos=grouped_photos,
        allowed_actions=allowed_actions,
        on_delete=lambda: st.rerun()
    )
    
    # ä¸Šä¼ ç…§ç‰‡æ¨¡æ€æ¡†
    if st.session_state.get('show_upload_photo_modal', False):
        show_upload_photo_modal(order)


def show_create_order_modal():
    """æ–°å»ºè®¢å•æ¨¡æ€æ¡†"""
    # ä½¿ç”¨ st.dialog æˆ–è‡ªå®šä¹‰æ¨¡æ€æ¡†
    pass


def show_edit_order_form(order):
    """ç¼–è¾‘è®¢å•è¡¨å•"""
    pass


def show_upload_photo_modal(order):
    """ä¸Šä¼ ç…§ç‰‡æ¨¡æ€æ¡†"""
    pass
```

---

## ğŸ§© å¯å¤ç”¨ç»„ä»¶è®¾è®¡

### 1. `components/order_list.py` - è®¢å•åˆ—è¡¨ç»„ä»¶

```python
"""
è®¢å•åˆ—è¡¨ç»„ä»¶

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºè®¢å•åˆ—è¡¨ï¼ˆç´§å‡‘å¡ç‰‡æ ·å¼ï¼‰
- æ”¯æŒæœç´¢ã€ç­›é€‰
- æ”¯æŒåˆ†é¡µ
- ç‚¹å‡»é€‰ä¸­è®¢å•
"""

import streamlit as st


def show(order_service, search="", status_filter="å…¨éƒ¨", page_size=10):
    """
    æ˜¾ç¤ºè®¢å•åˆ—è¡¨
    
    Returns:
        selected_order: ç”¨æˆ·ç‚¹å‡»é€‰ä¸­çš„è®¢å•ï¼ˆdictï¼‰æˆ– None
    """
    # åŠ è½½è®¢å•
    result = order_service.list_orders(
        page=st.session_state.get('order_list_page', 1),
        limit=page_size,
        status="all" if status_filter == "å…¨éƒ¨" else status_filter,
        search=search
    )
    
    if not result.get('success'):
        st.error(f"åŠ è½½å¤±è´¥ï¼š{result.get('message')}")
        return None
    
    data = result['data']
    orders = data.get('orders', [])
    pagination = data.get('pagination', {})
    
    # æ˜¾ç¤ºè®¢å•å¡ç‰‡
    selected_order = None
    
    for order in orders:
        is_selected = (order['_id'] == st.session_state.get('selected_order_id'))
        
        # è®¢å•å¡ç‰‡ï¼ˆç´§å‡‘æ ·å¼ï¼‰
        with st.container():
            if is_selected:
                st.markdown(f"""
                <div style="background: #e8f4f8; padding: 10px; border-radius: 5px; border-left: 4px solid #2196F3; margin-bottom: 8px;">
                    <b>ğŸ“„ {order['order_number']}</b><br/>
                    {order['customer_name']}<br/>
                    <span style="color: #666; font-size: 0.9em;">
                        {order['order_status']} | {order.get('progress_percentage', 0)}%
                    </span>
                </div>
                """, unsafe_allow_html=True)
            else:
                if st.button(
                    f"ğŸ“„ {order['order_number']}\n{order['customer_name']}\n{order['order_status']} | {order.get('progress_percentage', 0)}%",
                    key=f"order_{order['_id']}",
                    use_container_width=True
                ):
                    selected_order = order
    
    # åˆ†é¡µ
    if pagination.get('total_pages', 1) > 1:
        cols = st.columns(3)
        with cols[0]:
            if st.button("â—€ ä¸Šä¸€é¡µ", disabled=(pagination.get('page', 1) == 1)):
                st.session_state.order_list_page = pagination['page'] - 1
                st.rerun()
        with cols[1]:
            st.markdown(f"<center>{pagination.get('page', 1)}/{pagination.get('total_pages', 1)}</center>", unsafe_allow_html=True)
        with cols[2]:
            if st.button("ä¸‹ä¸€é¡µ â–¶", disabled=(pagination.get('page', 1) >= pagination.get('total_pages', 1))):
                st.session_state.order_list_page = pagination['page'] + 1
                st.rerun()
    
    return selected_order
```

### 2. `components/order_info_card.py` - è®¢å•ä¿¡æ¯å¡ç‰‡

```python
"""
è®¢å•ä¿¡æ¯å¡ç‰‡ç»„ä»¶

æ˜¾ç¤ºè®¢å•çš„æ ¸å¿ƒä¿¡æ¯ï¼ˆé¡¶éƒ¨æ¦‚è§ˆï¼‰
"""

import streamlit as st


def show(order):
    """æ˜¾ç¤ºè®¢å•ä¿¡æ¯å¡ç‰‡"""
    st.markdown(f"""
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                padding: 20px; border-radius: 10px; color: white; margin-bottom: 20px;">
        <h3 style="margin: 0; color: white;">ğŸ“‹ è®¢å• {order.get('order_number')}</h3>
        <div style="margin-top: 10px; display: flex; gap: 20px;">
            <div>
                <div style="opacity: 0.9;">å®¢æˆ·</div>
                <div style="font-size: 1.2em; font-weight: bold;">{order.get('customer_name')}</div>
            </div>
            <div>
                <div style="opacity: 0.9;">è”ç³»æ–¹å¼</div>
                <div style="font-size: 1.2em;">ğŸ“ {order.get('customer_phone')}</div>
            </div>
            <div>
                <div style="opacity: 0.9;">é’»çŸ³ç±»å‹</div>
                <div style="font-size: 1.2em;">ğŸ’ {order.get('diamond_type')} | {order.get('diamond_size')}</div>
            </div>
            <div>
                <div style="opacity: 0.9;">çŠ¶æ€</div>
                <div style="font-size: 1.2em;">{order.get('order_status')} | {order.get('progress_percentage', 0)}%</div>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
```

### 3. `components/progress_timeline.py` - è¿›åº¦æ—¶é—´è½´

```python
"""
è¿›åº¦æ—¶é—´è½´ç»„ä»¶

åŠŸèƒ½ï¼š
- æ˜¾ç¤ºåˆ¶ä½œè¿›åº¦æ—¶é—´è½´
- æ”¯æŒå¼€å§‹é˜¶æ®µ
- æ”¯æŒå®Œæˆé˜¶æ®µ
- æ”¯æŒæ·»åŠ å¤‡æ³¨
- é›†æˆç…§ç‰‡ä¸Šä¼ 
"""

import streamlit as st
from datetime import datetime, date


def show(progress_service, order_id, progress_data, allowed_actions, on_update):
    """æ˜¾ç¤ºè¿›åº¦æ—¶é—´è½´"""
    
    # æ ¼å¼åŒ–è¿›åº¦æ•°æ®
    timeline = progress_service.format_progress_for_timeline(progress_data)
    
    for stage in timeline:
        status = stage['status']
        stage_id = stage['stage_id']
        
        # çŠ¶æ€å›¾æ ‡
        icon = {'pending': 'â¸ï¸', 'in_progress': 'ğŸ”„', 'completed': 'âœ…'}[status]
        
        # å±•å¼€å®¹å™¨
        with st.expander(f"{icon} {stage['stage_name']} - {stage['status_display']}", expanded=(status == 'in_progress')):
            
            # æ—¶é—´ä¿¡æ¯
            if stage.get('start_time'):
                st.markdown(f"**å¼€å§‹æ—¶é—´ï¼š** {stage['start_time']}")
            if stage.get('completion_time'):
                st.markdown(f"**å®Œæˆæ—¶é—´ï¼š** {stage['completion_time']}")
            
            # å¤‡æ³¨
            if stage.get('notes'):
                st.markdown(f"**å¤‡æ³¨ï¼š** {stage['notes']}")
            
            # ç…§ç‰‡
            if stage.get('photos'):
                st.markdown(f"**ç…§ç‰‡ï¼š** {len(stage['photos'])} å¼ ")
                # æ˜¾ç¤ºç¼©ç•¥å›¾
            
            st.markdown("---")
            
            # æ“ä½œæŒ‰é’®
            if status == 'pending' and 'start_stage' in allowed_actions:
                if st.button(f"â–¶ å¼€å§‹æ­¤é˜¶æ®µ", key=f"start_{stage_id}"):
                    start_stage(progress_service, order_id, stage_id, on_update)
            
            elif status == 'in_progress' and 'complete_stage' in allowed_actions:
                if st.button(f"âœ… å®Œæˆæ­¤é˜¶æ®µ", key=f"complete_{stage_id}"):
                    complete_stage(progress_service, order_id, stage_id, on_update)


def start_stage(progress_service, order_id, stage_id, on_update):
    """å¼€å§‹é˜¶æ®µ"""
    result = progress_service.start_stage(order_id, stage_id, notes="")
    if result.get('success'):
        st.success("é˜¶æ®µå·²å¼€å§‹ï¼")
        on_update()
    else:
        st.error(f"æ“ä½œå¤±è´¥ï¼š{result.get('message')}")


def complete_stage(progress_service, order_id, stage_id, on_update):
    """å®Œæˆé˜¶æ®µï¼ˆå¸¦è¡¨å•ï¼‰"""
    with st.form(f"complete_form_{stage_id}"):
        notes = st.text_area("å¤‡æ³¨", placeholder="è¾“å…¥æœ¬é˜¶æ®µçš„å¤‡æ³¨ä¿¡æ¯")
        actual_completion = st.date_input("å®é™…å®Œæˆæ—¥æœŸ", value=date.today())
        
        # ç…§ç‰‡ä¸Šä¼ 
        st.markdown("#### ä¸Šä¼ å®Œæˆç…§ç‰‡ï¼ˆå¯é€‰ï¼‰")
        photos = st.file_uploader(
            "é€‰æ‹©ç…§ç‰‡",
            type=['jpg', 'jpeg', 'png'],
            accept_multiple_files=True,
            key=f"photos_{stage_id}"
        )
        
        if st.form_submit_button("âœ… ç¡®è®¤å®Œæˆ"):
            result = progress_service.complete_stage(
                order_id, 
                stage_id, 
                notes, 
                actual_completion.strftime('%Y-%m-%d'),
                photos
            )
            if result.get('success'):
                st.success("é˜¶æ®µå·²å®Œæˆï¼")
                on_update()
            else:
                st.error(f"æ“ä½œå¤±è´¥ï¼š{result.get('message')}")
```

### 4. `components/photo_gallery.py` - ç…§ç‰‡ç”»å»Š

```python
"""
ç…§ç‰‡ç”»å»Šç»„ä»¶

åŠŸèƒ½ï¼š
- æŒ‰é˜¶æ®µåˆ†ç»„æ˜¾ç¤ºç…§ç‰‡
- æ”¯æŒæŸ¥çœ‹å¤§å›¾
- æ”¯æŒåˆ é™¤ç…§ç‰‡
"""

import streamlit as st


def show(photo_service, order_id, photos_data, grouped_photos, allowed_actions, on_delete):
    """æ˜¾ç¤ºç…§ç‰‡ç”»å»Š"""
    
    if not photos_data:
        st.info("è¿˜æ²¡æœ‰ä¸Šä¼ ç…§ç‰‡")
        return
    
    # æŒ‰é˜¶æ®µæ˜¾ç¤º
    for stage_name, photos in grouped_photos.items():
        st.markdown(f"### ğŸ“· {stage_name}")
        
        # ç…§ç‰‡ç½‘æ ¼ï¼ˆæ¯è¡Œ3å¼ ï¼‰
        cols = st.columns(3)
        for i, photo in enumerate(photos):
            with cols[i % 3]:
                # æ˜¾ç¤ºç…§ç‰‡
                st.image(photo.get('url'), caption=photo.get('description', ''))
                
                # åˆ é™¤æŒ‰é’®
                if 'delete_photo' in allowed_actions:
                    if st.button("ğŸ—‘ï¸", key=f"delete_{photo.get('_id')}"):
                        delete_photo(photo_service, photo.get('_id'), on_delete)
        
        st.markdown("---")


def delete_photo(photo_service, photo_id, on_delete):
    """åˆ é™¤ç…§ç‰‡"""
    if st.confirm("ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ"):
        result = photo_service.delete_photo(photo_id)
        if result.get('success'):
            st.success("ç…§ç‰‡å·²åˆ é™¤ï¼")
            on_delete()
        else:
            st.error(f"åˆ é™¤å¤±è´¥ï¼š{result.get('message')}")
```

---

## ğŸ”„ å®æ–½æ­¥éª¤

### ç¬¬1æ­¥ï¼šåˆ›å»ºç›®å½•ç»“æ„ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
mkdir streamlit_app/pages
mkdir streamlit_app/components
touch streamlit_app/components/__init__.py
```

### ç¬¬2æ­¥ï¼šåˆ›å»ºç»„ä»¶ï¼ˆ2-3å°æ—¶ï¼‰
æŒ‰é¡ºåºåˆ›å»ºï¼š
1. âœ… `order_info_card.py` - æœ€ç®€å•
2. âœ… `order_list.py` - ä¸­ç­‰
3. âœ… `photo_gallery.py` - ä¸­ç­‰
4. âœ… `progress_timeline.py` - æœ€å¤æ‚

### ç¬¬3æ­¥ï¼šåˆ›å»ºä¸»é¡µé¢ï¼ˆ2-3å°æ—¶ï¼‰
- âœ… `admin_orders_center.py`

### ç¬¬4æ­¥ï¼šæ›´æ–°ä¸»å¯¼èˆªï¼ˆ30åˆ†é’Ÿï¼‰
```python
# streamlit_app/main.py

# ä¿®æ”¹ç®¡ç†åå°èœå•
admin_options = [
    "æ•°æ®ä»ªè¡¨æ¿", 
    "è®¢å•ä¸­å¿ƒ",  # æ–°ï¼æ›¿ä»£åŸæ¥çš„"è®¢å•ç®¡ç†"ã€"è¿›åº¦ç®¡ç†"ã€"ç…§ç‰‡ç®¡ç†"
    "ç”¨æˆ·ç®¡ç†", 
    "è§’è‰²æƒé™"
]

if st.session_state.admin_page == "è®¢å•ä¸­å¿ƒ":
    from pages import admin_orders_center  # å¯¼å…¥æ–°é¡µé¢
    admin_orders_center.show_page()
```

### ç¬¬5æ­¥ï¼šæµ‹è¯•ï¼ˆ1-2å°æ—¶ï¼‰
- âœ… è®¢å•åˆ—è¡¨åŠ è½½
- âœ… è®¢å•é€‰æ‹©å’Œåˆ‡æ¢
- âœ… åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹/ç¼–è¾‘
- âœ… è¿›åº¦æ›´æ–°
- âœ… ç…§ç‰‡ä¸Šä¼ /æŸ¥çœ‹/åˆ é™¤
- âœ… æƒé™æ§åˆ¶

### ç¬¬6æ­¥ï¼šæ¸…ç†æ—§ä»£ç ï¼ˆå¯é€‰ï¼‰
- âœ… `pages_backup/` ä¿ç•™ä½œä¸ºå¤‡ä»½
- âœ… ç§»é™¤ä¸»å¯¼èˆªä¸­çš„æ—§å…¥å£

---

## ğŸ“Š æ–°æ—§æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | æ—§æ–¹æ¡ˆï¼ˆä¸‰ä¸ªé¡µé¢ï¼‰ | æ–°æ–¹æ¡ˆï¼ˆè®¢å•ä¸­å¿ƒï¼‰ | æ”¹å–„ |
|------|------------------|------------------|------|
| **ç”¨æˆ·æ“ä½œæ­¥éª¤** | 5-8æ­¥ | 2-3æ­¥ | â¬‡ï¸ 60% |
| **é¡µé¢åˆ‡æ¢æ¬¡æ•°** | 3-4æ¬¡ | 0æ¬¡ | â¬‡ï¸ 100% |
| **é‡å¤æœç´¢** | æ˜¯ | å¦ | âœ… |
| **æ•°æ®ä¸€è‡´æ€§** | éœ€æ‰‹åŠ¨åˆ·æ–° | è‡ªåŠ¨åŒæ­¥ | âœ… |
| **ä»£ç è¡Œæ•°** | ~1900è¡Œ | ~1200è¡Œ | â¬‡ï¸ 37% |
| **Serviceé›†æˆ** | 20% | 100% | â¬†ï¸ 80% |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ | â¬‡ï¸ 50% |

---

## â±ï¸ æ—¶é—´ä¼°ç®—

### å¿«é€Ÿç‰ˆæœ¬ï¼ˆMVPï¼‰- 2å¤©
**åªå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼š**
- Day 1: 
  - ä¸Šåˆï¼šåˆ›å»ºåŸºç¡€ç»„ä»¶ï¼ˆorder_list, order_info_cardï¼‰
  - ä¸‹åˆï¼šåˆ›å»ºä¸»é¡µé¢æ¡†æ¶ + åŸºæœ¬ä¿¡æ¯Tab
- Day 2:
  - ä¸Šåˆï¼šè¿›åº¦Tabï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºï¼Œæš‚ä¸æ”¯æŒæ›´æ–°ï¼‰
  - ä¸‹åˆï¼šç…§ç‰‡Tabï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºï¼Œæš‚ä¸æ”¯æŒä¸Šä¼ ï¼‰+ æµ‹è¯•

### å®Œæ•´ç‰ˆæœ¬ - 3-4å¤©
- Day 1: åˆ›å»ºæ‰€æœ‰ç»„ä»¶
- Day 2: åˆ›å»ºä¸»é¡µé¢ + åŸºæœ¬ä¿¡æ¯Tabï¼ˆå®Œæ•´ç‰ˆï¼‰
- Day 3: è¿›åº¦Tabï¼ˆå®Œæ•´ç‰ˆï¼Œæ”¯æŒæ›´æ–°ï¼‰+ ç…§ç‰‡Tabï¼ˆå®Œæ•´ç‰ˆï¼Œæ”¯æŒä¸Šä¼ /åˆ é™¤ï¼‰
- Day 4: å…¨é¢æµ‹è¯• + ä¼˜åŒ– + æ›´æ–°å¯¼èˆª

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### å¯¹ç”¨æˆ·
1. âœ… **ä¸€ä¸ªé¡µé¢å®Œæˆæ‰€æœ‰æ“ä½œ** - ä¸å†åˆ‡æ¢é¡µé¢
2. âœ… **é›¶é‡å¤æœç´¢** - é€‰ä¸€æ¬¡è®¢å•ï¼Œçœ‹æ‰€æœ‰ä¿¡æ¯
3. âœ… **å®æ—¶æ•°æ®** - æ›´æ–°ç«‹å³åæ˜ 
4. âœ… **æ¸…æ™°çš„æ“ä½œæµ** - å·¦ä¾§é€‰è®¢å• â†’ å³ä¾§çœ‹è¯¦æƒ…/æ“ä½œ

### å¯¹å¼€å‘è€…
1. âœ… **ä»£ç æ›´å°‘** - å‡å°‘37%ä»£ç é‡
2. âœ… **é€»è¾‘æ›´æ¸…æ™°** - ç»„ä»¶åŒ–ï¼ŒèŒè´£æ˜ç¡®
3. âœ… **100% Serviceé›†æˆ** - å……åˆ†åˆ©ç”¨å·²æœ‰æˆæœ
4. âœ… **æ˜“äºç»´æŠ¤** - ç»„ä»¶ç‹¬ç«‹ï¼Œä¿®æ”¹å½±å“å°
5. âœ… **æ˜“äºæ‰©å±•** - æ·»åŠ æ–°åŠŸèƒ½åªéœ€åŠ ç»„ä»¶

---

## ğŸš€ æˆ‘çš„å»ºè®®

### æ¨èæ–¹æ¡ˆï¼š**ç«‹å³å¼€å§‹å®Œæ•´ç‰ˆï¼**

**ç†ç”±ï¼š**
1. âœ… ä½ è¯´å¯ä»¥"æ¿€è¿›ä¸€ç‚¹"ï¼Œè¿™å°±æ˜¯æœ€æ¿€è¿›çš„æ–¹æ¡ˆ
2. âœ… 3-4å¤©æ—¶é—´å¯æ§
3. âœ… æ•ˆæœ**ç«‹ç«¿è§å½±**ï¼Œç”¨æˆ·ä½“éªŒ**è´¨çš„é£è·ƒ**
4. âœ… å……åˆ†åˆ©ç”¨å·²å¼€å‘çš„ Service å±‚
5. âœ… ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰ç—›ç‚¹

**é£é™©æ§åˆ¶ï¼š**
- âœ… æ—§é¡µé¢ä¿ç•™åœ¨ `pages_backup/`ï¼Œéšæ—¶å¯ä»¥å›é€€
- âœ… ç»„ä»¶åŒ–å¼€å‘ï¼Œæ¯ä¸ªç»„ä»¶ç‹¬ç«‹æµ‹è¯•
- âœ… æ¸è¿›ä¸Šçº¿ï¼šå…ˆä¸ŠåŸºç¡€åŠŸèƒ½ï¼Œå†é€æ­¥å®Œå–„

---

## ğŸ¬ ç°åœ¨å°±å¼€å§‹ï¼Ÿ

æˆ‘å¯ä»¥ç«‹å³å¸®ä½ ï¼š

**é€‰é¡¹ Aï¼šç«‹å³å¼€å§‹å¼€å‘** âš¡
1. åˆ›å»ºç›®å½•ç»“æ„
2. ä»æœ€ç®€å•çš„ `order_info_card.py` å¼€å§‹
3. é€æ­¥å®Œæˆæ‰€æœ‰ç»„ä»¶
4. ç»„è£…æˆå®Œæ•´é¡µé¢

**é€‰é¡¹ Bï¼šå…ˆåšä¸€ä¸ªåŸå‹**
1. åªåšè®¢å•åˆ—è¡¨ + åŸºæœ¬ä¿¡æ¯Tab
2. ä½ å…ˆçœ‹çœ‹æ•ˆæœå’Œä½“éªŒ
3. æ»¡æ„åå†å®Œæˆè¿›åº¦å’Œç…§ç‰‡Tab

**é€‰é¡¹ Cï¼šä½ è¿˜æœ‰å…¶ä»–æƒ³æ³•ï¼Ÿ**

ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿè¦ä¸è¦**ç°åœ¨å°±å¼€å§‹**ï¼ŸğŸš€

